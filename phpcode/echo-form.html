<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Assignment 2 - Echo Test Form</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 0 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: inline-block; width: 150px; font-weight: bold; }
        select, input { padding: 5px; width: 250px; }
        #output-container { background: #f4f4f4; padding: 15px; border: 1px solid #ccc; margin-top: 20px; overflow-x: auto; }
        button { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h2>Echo Test Form</h2>
    <p>Use this form to test how different server-side languages handle various HTTP methods and encodings.</p>

    <form id="echoForm" action="phpcode/echo-php.php" method="POST">
        <div class="form-group">
            <label for="langSelect">Target Language:</label>
            <select id="langSelect">
                <option value="phpcode/echo-php.php">PHP (echo-php.php)</option>
                <option value="perlcode/perl-echo.pl">Perl (perl-echo.pl)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="methodSelect">HTTP Method:</label>
            <select id="methodSelect" name="_method">
                <option value="GET">GET</option>
                <option value="POST" selected>POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
        </div>

        <div class="form-group">
            <label for="encodingSelect">Encoding:</label>
            <select id="encodingSelect">
                <option value="application/x-www-form-urlencoded">x-www-form-urlencoded</option>
                <option value="application/json">application/json</option>
            </select>
        </div>

        <div class="form-group">
            <label for="teamName">Team Name:</label>
            <input type="text" id="teamName" name="team" value="Sithu and Phyo">
        </div>
        <div class="form-group">
            <label for="messageBody">Message:</label>
            <input type="text" id="messageBody" name="message" value="Testing 123">
        </div>

        <button type="submit">Submit Echo Request</button>
    </form>

    <div id="output-container">
        <strong>Response Output:</strong>
        <pre id="responseOutput">Submit the form to see the server echo.</pre>
    </div>

    <script>
        document.getElementById('echoForm').addEventListener('submit', function(e) {
            // Prevent default only if JS is enabled to handle custom methods/encodings
            e.preventDefault();

            const url = document.getElementById('langSelect').value;
            const method = document.getElementById('methodSelect').value;
            const encoding = document.getElementById('encodingSelect').value;
            
            // Gather data from fields
            const data = {
                team: document.getElementById('teamName').value,
                message: document.getElementById('messageBody').value
            };

            let options = {
                method: method,
                headers: { 'Content-Type': encoding }
            };

            // GET requests cannot have a body; data is appended to URL
            if (method === 'GET') {
                const params = new URLSearchParams(data).toString();
                fetch(`${url}?${params}`, { method: 'GET' })
                    .then(res => res.text())
                    .then(displayOutput);
            } else {
                // Prepare body based on selected encoding
                if (encoding === 'application/json') {
                    options.body = JSON.stringify(data);
                } else {
                    options.body = new URLSearchParams(data);
                }

                fetch(url, options)
                    .then(res => res.text())
                    .then(displayOutput)
                    .catch(err => displayOutput("Error: " + err));
            }
        });

        function displayOutput(data) {
            document.getElementById('responseOutput').textContent = data;
        }
    </script>
</body>
</html>